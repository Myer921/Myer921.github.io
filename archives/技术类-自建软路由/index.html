<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <meta name="description" content="笛凌小组分享23事的地方" />
  

  
  
  

  
  <title>[技术类]自建软路由 | 喵萌博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="参考：http://www.tuicool.com/articles/NnU7Rz借鉴者：冰喵根据个人需要以及一些经验进行了修改 保证可用性通用性不保证
2015-12-4 修正文章几个错误
2016-2-15 更新dhcp2016-5-18 根据谷歌历史页面，找回本文章并修正部分错误2016-5-18 已经不使用软路由了，但还是懂一些的

鉴于本人路由经常抽风缘故，所以被逼无奈用起了软路由。">
<meta property="og:type" content="article">
<meta property="og:title" content="[技术类]自建软路由">
<meta property="og:url" content="https://morz.org/archives/技术类-自建软路由/index.html">
<meta property="og:site_name" content="喵萌博客">
<meta property="og:description" content="参考：http://www.tuicool.com/articles/NnU7Rz借鉴者：冰喵根据个人需要以及一些经验进行了修改 保证可用性通用性不保证
2015-12-4 修正文章几个错误
2016-2-15 更新dhcp2016-5-18 根据谷歌历史页面，找回本文章并修正部分错误2016-5-18 已经不使用软路由了，但还是懂一些的

鉴于本人路由经常抽风缘故，所以被逼无奈用起了软路由。">
<meta property="og:updated_time" content="2016-08-09T18:36:55.413Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="[技术类]自建软路由">
<meta name="twitter:description" content="参考：http://www.tuicool.com/articles/NnU7Rz借鉴者：冰喵根据个人需要以及一些经验进行了修改 保证可用性通用性不保证
2015-12-4 修正文章几个错误
2016-2-15 更新dhcp2016-5-18 根据谷歌历史页面，找回本文章并修正部分错误2016-5-18 已经不使用软路由了，但还是懂一些的

鉴于本人路由经常抽风缘故，所以被逼无奈用起了软路由。">
  
  
    <link rel="icon" href="/css/images/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css">
  

  
</head>
<body class="home blog custom-background custom-font-enabled single-author">
  <div id="page" class="hfeed site">
      <header id="masthead" class="site-header" role="banner">
    <hgroup>
      <h1 class="site-title">
        <a href="/" title="喵萌博客" rel="home">喵萌博客</a>
      </h1>
      
        <h2 class="site-description">
          <a href="/" id="subtitle">笛凌小组的博客</a>
        </h2>
      
    </hgroup>

    <nav id="site-navigation" class="main-navigation" role="navigation">
            <button class="menu-toggle">菜单</button>
            <a class="assistive-text" href="/#content" title="跳至内容">跳至内容</a><!--TODO-->
            <div class="menu-main-container">
                <ul id="menu-main" class="nav-menu">
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/">主页</a></li>
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/archives">文章</a></li>
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://github.com/Myer921">Github</a></li>
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/archives/about/index.html">某只冰喵的介绍</a></li>
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/atom.xml">RSS</a></li>
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://github-io.morz.org">镜像(Github.io)</a></li>
                
                </ul>
            </div>
    </nav>
</header>
      <div id="main" class="wrapper">
        <div id="primary" class="site-content"><div id="content" role="main"><article id="post-技术类-自建软路由" class="post-技术类-自建软路由 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title article-title">
      [技术类]自建软路由
    </h1>
  

        
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><p>参考：<a href="http://www.tuicool.com/articles/NnU7Rz" target="_blank" rel="external">http://www.tuicool.com/articles/NnU7Rz</a><br>借鉴者：冰喵<br>根据个人需要以及一些经验进行了修改 保证可用性<br>通用性不保证</p>
<p>2015-12-4 修正文章几个错误</p>
<p>2016-2-15 更新dhcp<br>2016-5-18 根据谷歌历史页面，找回本文章并修正部分错误<br>2016-5-18 已经不使用软路由了，但还是懂一些的</p>
<hr>
<p>鉴于本人路由经常抽风缘故，所以被逼无奈用起了软路由。</p>
<p>（垃圾TP路由，wifi模式下ping路由时不时能得到和ping国外主机的结果 真是tm够了<br>教程开始<br>eth1 主板集成卡-与光猫链接<br>eth2 pci千兆卡-与电脑连接（也可以和交换机连</p>
<p>软路由地址：192.168.233.1<br>子网掩码：255.255.255.0<br>DHCP分配范围： 192.168.233.100~192.168.233.200</p>
<p>pppoe部分（家庭常用</p>
<p>首先安装pppoe组件 让软路由能自行拨号</p>
<h1 id="apt-get-install-pppoeconf"><a href="#apt-get-install-pppoeconf" class="headerlink" title="apt-get install pppoeconf"></a>apt-get install pppoeconf</h1><p>安装结束后执行pppoeconf，按照提示来配置你的账号密码<br>接下来编辑/etc/network/interfaces<br>配置eth2的IP地址为 192.168.233.1</p>
<p>auto eth2<br>iface eth2 inet static<br>address 192.168.233.1<br>netmask 255.255.255.0<br>broadcast 192.168.233.255</p>
<p>此时宽带连接的网卡名称是ppp0</p>
<p>开启对应的转发</p>
<p>修改 /etc/sysctl.conf，开启转发 实现路由功能</p>
<p>net.ipv4.ip_forward=1</p>
<p>设置iptables 让设备可以连网并设置安全规则</p>
<p>安全无小事，对于能获取公网ip的网络来说这个至关重要<br>（建议写一个shell脚本运行</p>
<p>#配置，禁止进，允许出，允许回环网卡<br>iptables -P INPUT DROP<br>iptables -P OUTPUT ACCEPT<br>iptables -A INPUT -i lo -j ACCEPT</p>
<p>#只允许在路由内网进行ssh管理操作 如果<br>注意：-i参数为指定某网卡<br>iptables -A INPUT -i eth2 -p tcp -m tcp –dport 22 -j ACCEPT</p>
<p>设置转发 上面的转发设置似乎要配合这个才能用 如果有什么错误请指教</p>
<p>iptables -A POSTROUTING -s 192.168.233.0/24 -o ppp0 -j MASQUERADE</p>
<p>让软路由重启后iptables依然生效，还需要这样做</p>
<h1 id="debian-ubuntu"><a href="#debian-ubuntu" class="headerlink" title="debian/ubuntu"></a>debian/ubuntu</h1><p>sudo iptables-save &gt; /etc/iptables<br>sudo nano /etc/network/if-pre-up.d/firewall</p>
<p>#将以下文件保存在/etc/network/if-pre-up.d/firewall中</p>
<p>#!/bin/sh<br>/sbin/iptables-restore &lt; /etc/iptables</p>
<p>#按下Control-X 再输入 Y 保存以上脚本，接着给脚本赋予执行权限<br>sudo chmod +x /etc/network/if-pre-up.d/firewall</p>
<p>由于没有dhcp 接下来这一步设置电脑本地ip 来让电脑上网<br>（请把eth2的网卡口与你电脑的网卡口进行连接</p>
<p>dhcp配置<br>安装dnsmasq：apt-get install dnsmasq</p>
<p>备份原文件：mv /etc/dnsmasq.conf /etc/dnsmasq.conf-bak</p>
<p>编辑文件：nano /etc/dnsmasq.conf<br>并添加以下内容</p>
<p>conf-dir=/etc/dnsmasq.d</p>
<p>interface=eth2</p>
<p>listen-address=192.168.233.1</p>
<p>dhcp-range=192.168.233.2,192.168.233.200,48h</p>
<p>原则上来说这样就可以完成内网的dhcp步骤了 下面的设备也能自动获取ip了</p>
<p>欢迎大触们补充步骤</p>
<p>此时你的电脑就可以上网了</p>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/archives/技术类-自建软路由/index.html">
    <time datetime="2016-05-18T11:16:55.000Z" class="entry-date">
        2016-05-18
    </time>
</a>
    
    
    </footer>
</article>


    
<nav class="nav-single">
    <h3 class="assistive-text">文章导航</h3>
    
        <span class="nav-previous"><a href="/archives/Acg视频分享-禁绝的边境线-mp4/index.html" rel="prev"><span class="meta-nav">←</span> [Acg视频分享]禁绝的边境线.mp4</a></span>
    
    
        <span class="nav-next"><a href="/archives/Acg视频分享-ClariS-『ひらひら-ひらら』/index.html" rel="next">[Acg视频分享]-ClariS 『ひらひら ひらら』 <span class="meta-nav">→</span></a></span>
    
</nav><!-- .nav-single -->






<section id="comments">
  <!-- 多说评论框 start -->
  <div class="ds-thread" data-thread-key="post-技术类-自建软路由" data-title="[技术类]自建软路由" data-url="https://morz.org//archives/技术类-自建软路由/index.html"></div>
  <!-- 多说评论框 end -->
  <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
  <script type="text/javascript">
  var duoshuoQuery = {short_name:'morz-duoshuo'};
    (function() {
	  var ds = document.createElement('script');
	  ds.type = 'text/javascript';ds.async = true;
	  ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//morz.org/js/embed.js';
	  ds.charset = 'UTF-8';
	  (document.getElementsByTagName('head')[0]
	   || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>
  <!-- 多说公共JS代码 end -->
</section>


</div></div>
        <div id="secondary" class="widget-area" role="complementary">
  
    <aside id="search" class="widget widget_search"><form role="search" method="get" accept-charset="utf-8" id="searchform" class="searchform" action="//google.com/search">
    <div>
        <input type="text" value="" name="s" id="s" />
        <input type="submit" id="searchsubmit" value="搜索" />
    </div>
</form></aside>
  
    
  
    
  
    
  <aside class="widget">
    <h3 class="widget-title">Recents</h3>
    <div class="widget-content">
      <ul>
        
          <li>
            <a href="/archives/某喵的电脑换新了/index.html">某喵的电脑换新了</a>
          </li>
        
          <li>
            <a href="/archives/about/index.html">关于我</a>
          </li>
        
          <li>
            <a href="/archives/Acg视频分享-禁绝的边境线-mp4/index.html">[Acg视频分享]禁绝的边境线.mp4</a>
          </li>
        
          <li>
            <a href="/archives/技术类-自建软路由/index.html">[技术类]自建软路由</a>
          </li>
        
          <li>
            <a href="/archives/Acg视频分享-ClariS-『ひらひら-ひらら』/index.html">[Acg视频分享]-ClariS 『ひらひら ひらら』</a>
          </li>
        
      </ul>
    </div>
  </aside>

  
    
<div class="widget">
	<h3 class="widget-title">给冰喵留链接的伙伴们</h3>
	<ul class="blogroll list-unstyled">
	
		<li> <a href="https://jk.gy/" title="Haku的博客" target="_blank"> <i class="mdi-action-launch"></i> Haku</a></li>
	
		<li> <a href="https://www.anotherhome.net/" title="网红Diygod" target="_blank"> <i class="mdi-action-launch"></i> DIYgod</a></li>
	
		<li> <a href="https://imguoguo.com/" title="灵魂画师果果" target="_blank"> <i class="mdi-action-launch"></i> GuoGuo</a></li>
	
		<li> <a href="https://nnya.cat" title="喵喵喵 Andy的静态博客" target="_blank"> <i class="mdi-action-launch"></i> 喵呜~</a></li>
	
		<li> <a href="https://blog.lwl12.com/" title="和DiyGod关系非常~ 本来想放单独位置的 然而我并不会用nodejs" target="_blank"> <i class="mdi-action-launch"></i> LWL的自由天空</a></li>
	
		<li> <a href="https://nekosc.com" title="可以拆卸的零件√" target="_blank"> <i class="mdi-action-launch"></i> 零件的博客</a></li>
	
		<li> <a href="https://oao.moe" title="baka羽毛好好吃" target="_blank"> <i class="mdi-action-launch"></i> 云羽桑</a></li>
	
		<li> <a href="https://satori.moe" title="我家萌物,老大" target="_blank"> <i class="mdi-action-launch"></i> 萌物觉</a></li>
	
		<li> <a href="https://huihui.moe" title="灰灰是个可爱的男孩纸" target="_blank"> <i class="mdi-action-launch"></i> 小灰灰</a></li>
	
		<li> <a href="http://iloli.cc/" title="诸君，我喜欢萝莉！" target="_blank"> <i class="mdi-action-launch"></i> 爱萝莉</a></li>
	
		<li> <a href="http://www.mewx.org/" title="（Android工程师哦/爱看小说）" target="_blank"> <i class="mdi-action-launch"></i> MewX</a></li>
	
	</ul>
</div>


  
</div>
      </div>
      <footer id="colophon" role="contentinfo">
	<p>
 托管于阿里云. 由<a href="//www.upyun.com" target="_blank" rel="nofollow"> <img src="//static.morz.org/data/img/upyun.png" width="60" height="30" style="margin: -15px 0"/></a>提供页面加速<br>
&copy; 2014-2016 喵萌博客. 由<a href="https://hexo.io">hexo</a>强力驱动 | 使用 <a href="https://github.com/wizardforcel/hexo-theme-cyanstyle">cyanstyle</a> 主题
<br>
	</p>
	<p>
<script type="text/javascript" src="https://api.lwl12.com/hitokoto/main/get?encode=js&charset=utf-8"></script>
<div id="lwlhitokoto">底部一言:<script>lwlhitokoto()</script></div>
	本站点由笛凌小组进行技术维护
<br>备案号:<a href="http://www.miitbeian.gov.cn/">辽ICP备16002210号-2</a>

	</p>

</footer>
    
<script src="/js/jquery-2.0.3.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

<script src="/js/navigation.js"></script>

<div id="bg"></div>

  </div>
</body>
</html>